{% extends "base.html" %}

{% block title %}Driver Details{% endblock %}

{% block content %}
<h1>Driver Details</h1>

<!-- ‚úÖ Display Driver Details -->
<div id="driver-info">
    <p><strong>Name:</strong> <span id="driver-name">{{ driver.name }}</span></p>
    <p><strong>Age:</strong> <span id="driver-age">{{ driver.age }}</span></p>
    <p><strong>Total Race Wins:</strong> <span id="driver-race-wins">{{ driver.total_race_wins }}</span></p>
    <p><strong>Total Pole Positions:</strong> <span id="driver-pole-positions">{{ driver.total_pole_positions }}</span></p>
</div>

{% if request.session.get("user_logged_in") %}
    <form id="delete-driver-form">
        <button type="button" id="delete-driver-btn" class="btn btn-danger">üóë Delete</button>
    </form>
{% endif %}

<script>
    document.getElementById("delete-driver-btn")?.addEventListener("click", async function () {
        const driverName = "{{ driver.name }}";

        const response = await fetch(`/drivers/delete_driver/${driverName}`, { method: "DELETE" });

        if (response.ok) {
            alert("‚úÖ Driver deleted successfully!");
            window.location.href = "/";
        } else {
            alert("‚ùå Failed to delete driver.");
        }
    });
</script>

<!-- <script>
    document.addEventListener("DOMContentLoaded", function () {
        const isUserLoggedIn = localStorage.getItem("userLoggedIn") === "true";
        if (isUserLoggedIn) {
            document.getElementById("delete-driver-btn").style.display = "block";
        }

        document.getElementById("delete-driver-btn").addEventListener("click", async function () {
            const driverName = document.getElementById("driver-name").textContent;

            if (!confirm("Are you sure you want to delete this driver?")) return;

            try {
                const response = await fetch(`/drivers/delete_driver/${driverName}`, { method: "DELETE" });
                if (!response.ok) throw new Error("Failed to delete driver");

                alert("‚úÖ Driver deleted successfully!");
                window.location.href = "/";
            } catch (error) {
                alert("‚ùå Error deleting driver: " + error.message);
            }
        });
    });
</script> -->

<!-- <script>
async function fetchDriver() {
    const params = new URLSearchParams(window.location.search);
    const driverName = params.get("name");

    const response = await fetch(`/drivers/get_driver/${driverName}`);
    const driver = await response.json();

    document.getElementById("driver-info").innerHTML = `
        <p><strong>Name:</strong> ${driver.name}</p>
        <p><strong>Age:</strong> ${driver.age}</p>
        <p><strong>Total Race Wins:</strong> ${driver.total_race_wins}</p>
    `;

    if (localStorage.getItem("userLoggedIn") === "true") {
        document.getElementById("delete-driver-btn").style.display = "block";
    }
}

fetchDriver();

    async function deleteDriver() {
        const params = new URLSearchParams(window.location.search);
        const driverName = params.get("name");

        if (!confirm("Are you sure you want to delete this driver?")) return;

        try {
            const response = await fetch(`/drivers/delete_driver/${driverName}`, { method: "DELETE" });
            if (!response.ok) throw new Error("Failed to delete driver");

            alert("‚úÖ Driver deleted successfully!");
            window.location.href = "/";
        } catch (error) {
            alert("‚ùå Error deleting driver: " + error.message);
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        fetchDriver();

        const deleteBtn = document.getElementById("delete-driver-btn");
        if (deleteBtn) {
            deleteBtn.addEventListener("click", deleteDriver);
        }
    });
</script> -->
{% endblock %}
